{% extends "base.html" %}

{% block content %}
<div class="container mt-4">

  <!-- Chats Section -->
  <div class="card shadow border-0">
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
      <h4 class="mb-0">My Chats</h4>
      <a href="{{ url_for('friends.send_request') }}" class="btn btn-light btn-sm">Add Friend</a>
    </div>

    <div class="card-body p-0">
      {% if friends %}
        <ul class="list-group list-group-flush">
          {% for friend in friends %}
            {% set friend_username = friend.username if friend.username is defined else friend %}
            {% set friend_handle = friend.handle if friend.handle is defined else friend %}
            {% set friend_bio = friend.bio if friend.bio is defined else '' %}
            {% set friend_profile_pic = friend.profile_pic_url if friend.profile_pic_url is defined else 'uploads/AgentC.png' %}

            <li class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
              <div class="d-flex align-items-center">
                <img src="{{ friend.profile_pic_url or url_for('static', filename=friend_profile_pic) }}" 
                     class="rounded-circle me-3" 
                     style="width: 50px; height: 50px; object-fit: cover;">
                <div>
                  <a href="{{ url_for('friends.view_friend', fname=friend_username) }}" class="fw-bold text-decoration-none">@{{ friend_handle }}</a>
                  {% if friend_bio %}
                    <p class="mb-0 text-muted small">{{ friend_bio }}</p>
                  {% endif %}
                </div>
              </div>

              <a href="{{ url_for('chat.chatscreen', friend=friend.username) }}" class="btn btn-outline-primary btn-sm">
                Open Chat
              </a>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <div class="p-4 text-center text-muted">
          <p>You donâ€™t have any friends yet</p>
        </div>
      {% endif %}
    </div>
  </div>

</div>
{% endblock %}
