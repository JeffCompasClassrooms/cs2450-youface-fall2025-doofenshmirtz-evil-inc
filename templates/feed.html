{% extends "base.html" %}

{% block content %}
<div class="container mt-4">

  <!-- Welcome Header -->
  <div class="text-center mb-4">
    <h2 data-tutorial="home-page">Behold, {{ username }} The User!</h2>
    <h3>The Home Page-Inator!</h3>
  </div>

  <div class="row">

    <!-- Main Feed Column -->
    <div class="col-lg-8">

      <!-- New Post Card -->
      <div class="card mb-4 shadow-sm">
        <div class="card-body">
          <h4 class="card-title">New Post</h4>
          <form method="post" action="{{ url_for('posts.post') }}">
            <div class="form-group mb-2">
              <textarea class="form-control" name="post" rows="3" placeholder="What's on your mind?"></textarea>
            </div>
            <div class="form-group mb-2">
              <input type="text" class="form-control" name="tags" placeholder="Add tags (comma-separated)">
            </div>
            <button type="submit" class="btn btn-primary" data-tutorial="post-btn">Post</button>
          </form>
        </div>
      </div>

      <!-- Feed Posts -->
      <h3 class="mb-3">My Feed</h3>

      {% for post in posts %}
      <div class="card mb-3 shadow-sm">
        <div class="card-body">

          <h5><a href="/@{{ post.user }}" data-tutorial="profile-page">@{{ post.user }}</a></h5>
          <small class="text-muted">{{ post.time|convert_time }}</small>
          <p class="mt-2">{{ post.text }}</p>

          {% if post.tags %}
          <p><small>Tags:
            {% for tag in post.tags %}
              <span class="badge bg-secondary">{{ tag }}</span>
            {% endfor %}
          </small></p>
          {% endif %}

          <!-- LIKE BUTTON -->
          <form class="d-inline like-form" action="{{ url_for('posts.like', post_id=post.doc_id) }}" method="post">
            <button type="submit" 
                    class="btn btn-sm like-btn {% if post.liked %}btn-primary{% else %}btn-outline-primary{% endif %}"
                    data-tutorial="like-btn">
              Like (<span class="like-count">{{ post.likes }}</span>)
            </button>
          </form>

          <!-- BOOKMARK BUTTON -->
          <form class="d-inline bookmark-form" action="{{ url_for('posts.bookmark', post_id=post.doc_id) }}" method="post">
            <button type="submit" 
                    class="btn btn-sm bookmark-btn {% if post.bookmarked %}btn-warning{% else %}btn-outline-warning{% endif %}"
                    data-tutorial="bookmark-btn">
              Bookmark
            </button>
          </form>

          <!-- COMMENT FORM -->
          <form method="post" action="{{ url_for('posts.comment', post_id=post.doc_id) }}" class="mt-2">
            <div class="input-group">
              <input type="text" name="comment" class="form-control" placeholder="Write a comment...">
              <button type="submit" class="btn btn-primary btn-sm">Post</button>
            </div>
          </form>

          <a href="{{ url_for('posts.view_post', post_id=post.doc_id) }}" class="btn btn-sm btn-link mt-1">
            View Comments ({{ post.comments|length|default(0) }})
          </a>

        </div>
      </div>
      {% endfor %}
    </div>

    <!-- Sidebar Column -->
    <div class="col-lg-4">

      <!-- View Liked/Bookmarked Posts -->
      <div class="card mb-4 shadow-sm">
        <div class="card-body text-center">
          <a href="{{ url_for('posts.view_liked_posts') }}" 
             class="btn btn-outline-primary mb-2 w-100" 
             data-tutorial="view-liked">
            View Liked Posts
          </a>
          <a href="{{ url_for('posts.view_bookmarked_posts') }}" 
             class="btn btn-outline-warning w-100" 
             data-tutorial="view-bookmarked">
            View Bookmarked Posts
          </a>
        </div>
      </div>

      <!-- Add Friend -->
      <div class="card mb-4 shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Add Friend</h5>
          <form method="post" action="/send_request">
            <div class="form-group mb-2">
              <input type="text" class="form-control" name="name" placeholder="Username">
            </div>
            <button type="submit" class="btn btn-primary btn-sm" data-tutorial="add-friend">Add Friend</button>
          </form>
        </div>
      </div>

      <!-- Friends List -->
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">My Friends</h5>
          {% if friends %}
          <ul class="list-group list-group-flush">
            {% for friend in friends %}
            <li class="list-group-item">
              <a href="{{ url_for('friends.view_friend', fname=friend['username']) }}" class="fw-bold" data-tutorial="profile-page">@{{ friend['username'] }}</a>
            </li>
            {% endfor %}
          </ul>
          {% else %}
            <p class="text-muted">You have no friends yet.</p>
          {% endif %}
        </div>
      </div>

    </div>

  </div>
  <meta name="username" content="{{ username }}">
</div>
{% endblock %}

{% block scripts %}

<script src="{{ url_for('static', filename='js/like_bookmark.js') }}"></script>
<script src="{{ url_for('static', filename='js/tutorial.js') }}"></script>
{% endblock %}
